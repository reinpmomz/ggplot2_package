---
title: "ggplot2"
subtitle: "Daryn Ramsden"
author: "thisisdaryn at gmail dot com"
date: "last updated: `r Sys.Date()`"
institution: ""
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    chakra: libs/remark.js
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---



```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(fig.align="center", fig.width=5, fig.height=5, warning = FALSE, message = FALSE)
```

```{r xaringan-themer, include = FALSE}
library(xaringanthemer)
duo_accent(
  primary_color = "ivory",
  secondary_color = "#310A31",
  header_font_google = google_font("Roboto", "400"),
  text_font_google   = google_font("Lato", "300"),
  code_font_family = "Fira Code",
  code_font_url = "https://cdn.rawgit.com/tonsky/FiraCode/1.204/distr/fira_code.css",
  header_color = "#f54278",
  title_slide_text_color = "#354a66"
)
```

## What is ggplot2

  * R package for doing data visualisation
  
  * uses the underlying `grid` package for graphics
  
  * inspired on the <i>Grammar of Graphics</i> by Leland Wilkinson (where the name comes from)
  
  * very popular, especially for publication quality graphics
  
  
#### Basic Idea: You shouldn't have to learn a new function for every type of graph you want to make



---
### The layers of the grammar of graphics

```{r echo=FALSE, out.width = 500}
knitr::include_graphics("images/grammar_layers.png")
```

.footnote[This image from presentation by Thomas Lin Pedersen https://github.com/thomasp85/ggplot2_workshop/blob/master/presentation.pdf]


---
### Brief explanation of the layers

  * <b>data</b>: the underlying data 


  * <b>mapping</b>: associating variables in the data with characteristics in the plot
  
  * statistic: translating the raw values in the data to statistics of interest e.g. identity, count 
  
  * scales: mapping the range of variables onto the range of the property
  
  * <b>geometries</b>: what type of chart
  
  * facets: criteria - if any - to show sub-graphs for
  
  * coordinates: the actual position of the objects on the screen or paper 

  * theme: aspects that have to do with appearance
  
---
### The essentials: what you really need to remember 


  Essential elements for using `ggplot2`:
    * data
--

    * mapping 
--

    * geometry
    
--

  All the other layers will get filled in with sensible defaults most of the time. (Except the default theme which I dislike all the time. Your mileage may vary.)
  
  
---
### Common geometries

  * `geom_bar`: to make a bar chart with counts
  
  * `geom_col`: to make a bar chart with totals
  
  * `geom_histogram`: histograms
  
  * `geom_boxplot`: boxplots
  
  * `geom_point`: scatter plots
  
  * `geom_line`: line graphs
  
  
  
  
---
### Common aesthetics

  * <i>x</i>
  
  * <i>y</i> 
  
  * <i>colour</i> or <i>color</i>
  
  * <i>fill</i> 
  
  * <i>size</i>
  
  * <i>group</i> 
  
  * <i>shape</i> 
  
<b>Not every aesthetic is applicable to every geometry</b>


---
### The objects/data involved

You need to create two objects:

  * a `ggplot` object
  
  * at least one geometry object, `geom_*`

Inputs/arguments

  * <i>data</i>: a dataframe
  
  * <i>mapping</i>: an aesthetic mapping created using the `aes` function.
  
<i>data</i> and <i>mapping</i> can be placed either into the parent `ggplot` object or into the `geom_*`


---
### Example: Making a scatter plot from the iris data set

#### How do we make a scatter plot of the <i>Petal.Length</i> (y-variable) vs <i>Sepal.Length</i>(x-variable) from the iris data set?

--

  * data: `iris`
  
--

  * mapping:
    * x: Sepal.Length
    * y: Petal.Length


---
### Example scatter plot code

A scatter plot of <i>Petal.Length</i> vs <i>Sepal.Length<i> in the `iris` data set.

```{r eval = FALSE}
library(ggplot2)

ggplot(data = iris, 
       mapping = aes(x = Sepal.Length, y = Petal.Length)
) + geom_point()
```




---
### Example scatter plot code

A scatter plot of <i>Petal.Length</i> vs <i>Sepal.Length<i> in the `iris` data set.

```{r}
library(ggplot2)

ggplot(data = iris, 
       mapping = aes(x = Sepal.Length, y = Petal.Length)
) + geom_point()
```


---
### Example scatter plot

What if we wanted to make the different species different colours?

(Notice that you don't have to name the inputs if you use the default order)
```{r}
ggplot(iris, 
       aes(x = Sepal.Length, y = Petal.Length, colour = Species)
) + geom_point()
```

---
### Example scatter plot

What if we wanted to make the different species different shapes instead?

```{r eval = FALSE}
library(ggplot2)

ggplot(iris, 
       aes(x = Sepal.Length, y = Petal.Length, shape = Species)
) + 
geom_point()
```

---
### Example scatter plot

What if we wanted to make the different species different shapes instead?

```{r}
library(ggplot2)

ggplot(iris, 
       aes(x = Sepal.Length, y = Petal.Length, shape = Species)
) + 
geom_point()
```



---
### Example histogram

What is the distribution of petal lengths in the data?

```{r eval = FALSE}
ggplot(data = iris, 
       mapping = aes(x = Petal.Length)) + 
  geom_histogram(fill = "purple", colour = "black")
```

---
### Example histogram

What is the distribution of petal lengths in the data?

```{r}
ggplot(data = iris, 
       mapping = aes(x = Petal.Length)) + 
  geom_histogram(fill = "purple", colour = "black")
```


---
### Observation

  * The previous graph set the `colour` and `fill` aesthetics outside of the `aes` function.
  
  * Did not want to link those to variables


---
### A common mistake

```{r eval = FALSE}
ggplot(data = iris, 
       mapping = aes(x = Petal.Length, fill = "purple")) + 
  geom_histogram()
```

---
### A common mistake

```{r}
ggplot(data = iris, 
       mapping = aes(x = Petal.Length, fill = "purple")) + 
  geom_histogram()
```


---
### Showing different species on the histogram

```{r}
ggplot(data = iris, 
       aes(x = Petal.Length,
           fill = Species)) + geom_histogram(colour = "black")
```

---
### There are many ways to tweak the charts

For example, changing the default stacking of groups and adding transparency 

```{r}
ggplot(data = iris, 
       aes(x = Petal.Length, 
           fill = Species)) + geom_histogram(position = "identity",
                                             alpha = 0.6)
```


---
### An example boxplot

How do we make a box plot to show the distribution of petal lengths for the different species?

The aesthetics:
  * x: Species
  
  * y: Petal.Length

Geometry:

  * `geom_boxplot`
  

---
### Showing the boxplot

```{r eval = FALSE}
ggplot(data = iris, 
       aes(x = Species, y = Petal.Length)) + geom_boxplot()
```  
  
---
### Showing the boxplot

```{r}
ggplot(data = iris, 
       aes(x = Species, y = Petal.Length)) + geom_boxplot()
```


---
### Same data, different geometry now

We can use the same data and aesthetic with a different geometry. Let's try `geom_violin`

```{r eval = FALSE}
ggplot(data = iris, 
       aes(x = Species, y = Petal.Length)) + geom_violin()
```

---
### Same data, different geometry now

We can use the same data and aesthetic with a different geometry. Let's try `geom_violin`

```{r}
ggplot(data = iris, 
       aes(x = Species, y = Petal.Length)) + geom_violin()
```


---
### Time to do some other examples